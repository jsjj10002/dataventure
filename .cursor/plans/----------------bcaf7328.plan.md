<!-- bcaf7328-3c0f-4f65-b910-58e16b3735b1 fc55c0ef-80fd-486e-a26c-4092d71fd78e -->
# AI 대화 오류 수정 계획

## 문제 분석

### 에러 로그

```
Invalid value for argument `role`. Expected MessageRole.
role: "candidate"  <- 소문자 전송
```

### 원인 파악

**1. MessageRole enum 불일치**

- **Prisma Schema** (service-core/prisma/schema.prisma:223-226):
  ```prisma
  enum MessageRole {
    AI         // AI 질문
    CANDIDATE  // 구직자 답변 (대문자)
  }
  ```

- **프론트엔드 코드** (app-web/src/app/interview/test-chat/page.tsx:121):
  ```typescript
  role: 'candidate',  // 소문자로 전송 ❌
  ```


**2. InterviewMode enum 불일치**

- **Prisma Schema** (service-core/prisma/schema.prisma:191-194):
  ```prisma
  enum InterviewMode {
    PRACTICE     // 연습 모드
    ACTUAL       // 실전 모드 (REAL이 아님!)
  }
  ```

- **프론트엔드 코드** (app-web/src/app/interview/setup/page.tsx:34):
  ```typescript
  const [mode, setMode] = useState<'PRACTICE' | 'REAL'>('PRACTICE');  // REAL은 존재하지 않음 ❌
  ```


**3. ContentType enum 확인 필요**

- **Prisma Schema** (service-core/prisma/schema.prisma:228-231):
  ```prisma
  enum ContentType {
    TEXT   // 텍스트 (대문자)
    AUDIO  // 음성
  }
  ```


## 수정 계획

### 1. 프론트엔드 - 텍스트 인터뷰 페이지

**파일**: `app-web/src/app/interview/test-chat/page.tsx`

**수정 사항**:

- 라인 121: `role: 'candidate'` → `role: 'CANDIDATE'` (대문자)
- 추가 검증: API 호출 시 올바른 enum 값 사용

### 2. 프론트엔드 - API 타입 정의

**파일**: `app-web/src/lib/api.ts`

**수정 사항**:

- `interviewAPI.start()` 함수에서 mode 타입 수정
- 'REAL' → 'ACTUAL'로 변경
- `interviewAPI.addMessage()` 함수에서 role 타입 명확히 정의

### 3. 프론트엔드 - 인터뷰 준비 페이지

**파일**: `app-web/src/app/interview/setup/page.tsx`

**수정 사항**:

- 라인 34: `type` 정의를 `'PRACTICE' | 'ACTUAL'`로 수정 (REAL → ACTUAL)
- 라인 126: API 호출 시 mode 값 확인

### 4. 백엔드 - 인터뷰 라우터 검증

**파일**: `service-core/src/routes/interview/index.ts`

**수정 사항**:

- 라인 199: role 기본값이 'CANDIDATE'인지 확인 (이미 올바름)
- 추가 검증: contentType도 대문자 'TEXT'인지 확인
- 에러 메시지 개선: enum 값 불일치 시 명확한 에러 메시지

### 5. 타입 안전성 강화

**새 파일**: `app-web/src/types/interview.ts` (또는 기존 파일 수정)

```typescript
// Prisma enum과 일치하는 타입 정의
export type MessageRole = 'AI' | 'CANDIDATE';
export type InterviewMode = 'PRACTICE' | 'ACTUAL';
export type ContentType = 'TEXT' | 'AUDIO';
export type InterviewStatus = 'IN_PROGRESS' | 'COMPLETED' | 'ABANDONED';
```

## 구현 순서

1. **타입 정의 수정** (app-web/src/types/interview.ts)

   - Prisma 스키마와 일치하는 타입 정의

2. **API 클라이언트 수정** (app-web/src/lib/api.ts)

   - 올바른 타입 사용

3. **인터뷰 준비 페이지 수정** (app-web/src/app/interview/setup/page.tsx)

   - REAL → ACTUAL 변경

4. **텍스트 인터뷰 페이지 수정** (app-web/src/app/interview/test-chat/page.tsx)

   - role: 'CANDIDATE' (대문자)
   - contentType: 'TEXT' (대문자)

5. **백엔드 검증 강화** (service-core/src/routes/interview/index.ts)

   - enum 값 검증 추가
   - 명확한 에러 메시지

## 공식 문서 참고사항

**Prisma Enum 사용**:

- Prisma enum은 대소문자를 구분함
- TypeScript에서 enum 값을 사용할 때는 정확히 일치해야 함
- 런타임 검증을 위해 Zod 또는 class-validator 사용 권장

**참고**:

- Prisma 공식 문서: https://www.prisma.io/docs/concepts/components/prisma-schema/data-model#defining-enums
- TypeScript enum best practices

## 검증 방법

1. 수정 후 TypeScript 컴파일 오류 확인
2. 메시지 전송 테스트 (텍스트 인터뷰)
3. Prisma Studio에서 저장된 데이터 확인
4. 다양한 시나리오 테스트:

   - PRACTICE 모드 시작
   - 메시지 전송
   - 인터뷰 완료
   - ACTUAL 모드도 동일하게 테스트

### To-dos

- [ ] 회원가입 페이지에 비밀번호 대문자/소문자 검증 추가
- [ ] 프로필 저장 후 대시보드로 자동 이동 기능 추가 (구직자/채용담당자)
- [ ] 프로필 사진 표시 오류 수정 (URL 전체 경로 생성 및 에러 처리)
- [ ] 대시보드 프로필 완성도 계산 개선 및 색상 로직 추가 (노란-초록-파란)
- [ ] 인터뷰 준비 페이지에 개발 테스트 버튼 추가
- [ ] 텍스트-텍스트 인터뷰 테스트 페이지 생성 (채팅 인터페이스)
- [ ] 텍스트 인터뷰 페이지와 백엔드 API 연동